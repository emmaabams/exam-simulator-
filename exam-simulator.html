<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMB Autos Exam Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .home-screen, .exam-screen, .results-screen {
            display: none;
        }

        .home-screen.active, .exam-screen.active, .results-screen.active {
            display: block;
        }

        .exam-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .exam-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            text-align: center;
        }

        .exam-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .exam-card h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .exam-card p {
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .exam-card .questions-count {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .settings-panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .settings-panel h3 {
            margin-bottom: 20px;
            color: #667eea;
        }

        .setting-item {
            margin-bottom: 20px;
        }

        .setting-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .setting-item input[type="number"],
        .setting-item select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .setting-item input:focus,
        .setting-item select:focus {
            outline: none;
            border-color: #667eea;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            box-shadow: 0 5px 20px rgba(108, 117, 125, 0.4);
        }

        .progress-bar-container {
            background: #e0e0e0;
            height: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s;
        }

        .exam-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .exam-info-item {
            text-align: center;
        }

        .exam-info-item label {
            display: block;
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .exam-info-item span {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
        }

        .timer {
            color: #dc3545 !important;
        }

        .question-card {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .question-number {
            color: #667eea;
            font-weight: 600;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.3em;
            margin-bottom: 25px;
            color: #333;
            line-height: 1.6;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            padding: 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .option:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }

        .option.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .option.correct {
            border-color: #28a745;
            background: #d4edda;
        }

        .option.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .option.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .option-letter {
            font-weight: bold;
            font-size: 1.2em;
            color: #667eea;
            min-width: 30px;
        }

        .option.correct .option-letter {
            color: #28a745;
        }

        .option.incorrect .option-letter {
            color: #dc3545;
        }

        .option-text {
            flex: 1;
            font-size: 1.05em;
        }

        .explanation {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
            display: none;
        }

        .explanation.show {
            display: block;
        }

        .explanation h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .explanation p {
            color: #856404;
            line-height: 1.6;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .results-summary {
            text-align: center;
            padding: 40px;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            color: white;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
        }

        .score-circle .score {
            font-size: 3em;
            font-weight: bold;
        }

        .score-circle .label {
            font-size: 1em;
            opacity: 0.9;
        }

        .pass-fail {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .pass {
            color: #28a745;
        }

        .fail {
            color: #dc3545;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-card .label {
            color: #666;
            font-size: 0.9em;
        }

        .review-section {
            margin-top: 40px;
            text-align: left;
        }

        .review-section h3 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .review-question {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 4px solid #dc3545;
        }

        .review-question.correct {
            border-left-color: #28a745;
        }

        .review-question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .review-question-text {
            font-weight: 600;
            margin-bottom: 10px;
        }

        .review-answer {
            font-size: 0.95em;
            color: #666;
        }

        .review-answer strong {
            color: #333;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }

            .exam-selector {
                grid-template-columns: 1fr;
            }

            .exam-info {
                flex-direction: column;
                gap: 15px;
            }

            .score-circle {
                width: 150px;
                height: 150px;
            }

            .score-circle .score {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Exam Simulator Pro</h1>
            <p>Master Your Exams with Confidence</p>
        </div>

        <div class="content">
            <!-- Home Screen -->
            <div class="home-screen active">
                <h2 style="margin-bottom: 20px; color: #667eea;">Select Your Exam</h2>
                <div class="exam-selector" id="examSelector"></div>

                <div class="settings-panel">
                    <h3>‚öôÔ∏è Exam Settings</h3>
                    
                    <div class="setting-item">
                        <label for="questionCount">Number of Questions:</label>
                        <input type="number" id="questionCount" min="5" max="200" value="20">
                    </div>

                    <div class="setting-item">
                        <label for="timeLimit">Time Limit (minutes, 0 for unlimited):</label>
                        <input type="number" id="timeLimit" min="0" max="240" value="30">
                    </div>

                    <div class="setting-item">
                        <label for="examMode">Exam Mode:</label>
                        <select id="examMode">
                            <option value="practice">Practice Mode (Instant Feedback)</option>
                            <option value="test">Test Mode (Feedback at End)</option>
                        </select>
                    </div>

                    <div class="setting-item checkbox-item">
                        <input type="checkbox" id="randomize" checked>
                        <label for="randomize">Randomize Questions</label>
                    </div>

                    <div class="setting-item checkbox-item">
                        <input type="checkbox" id="showExplanations" checked>
                        <label for="showExplanations">Show Explanations</label>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="startExam()" id="startBtn">Start Exam</button>
                </div>
            </div>

            <!-- Exam Screen -->
            <div class="exam-screen">
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>

                <div class="exam-info">
                    <div class="exam-info-item">
                        <label>Question</label>
                        <span id="currentQuestion">1</span> / <span id="totalQuestions">20</span>
                    </div>
                    <div class="exam-info-item">
                        <label>Score</label>
                        <span id="currentScore">0</span>%
                    </div>
                    <div class="exam-info-item">
                        <label>Time</label>
                        <span id="timer" class="timer">30:00</span>
                    </div>
                </div>

                <div class="question-card">
                    <div class="question-number" id="questionNumber">Question 1 of 20</div>
                    <div class="question-text" id="questionText"></div>
                    <div class="options" id="options"></div>
                    <div class="explanation" id="explanation"></div>
                </div>

                <div class="navigation">
                    <button class="btn btn-secondary" onclick="previousQuestion()" id="prevBtn">‚Üê Previous</button>
                    <button class="btn" onclick="nextQuestion()" id="nextBtn">Next ‚Üí</button>
                    <button class="btn" onclick="submitExam()" id="submitBtn" style="display: none;">Submit Exam</button>
                </div>
            </div>

            <!-- Results Screen -->
            <div class="results-screen">
                <div class="results-summary">
                    <div class="score-circle">
                        <div class="score" id="finalScore">0%</div>
                        <div class="label">Final Score</div>
                    </div>
                    
                    <div class="pass-fail" id="passFail"></div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="value" id="correctCount">0</div>
                            <div class="label">Correct Answers</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="incorrectCount">0</div>
                            <div class="label">Incorrect Answers</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="timeTaken">0:00</div>
                            <div class="label">Time Taken</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="accuracy">0%</div>
                            <div class="label">Accuracy</div>
                        </div>
                    </div>

                    <div class="review-section" id="reviewSection"></div>

                    <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: center;">
                        <button class="btn btn-secondary" onclick="reviewAnswers()">Review Answers</button>
                        <button class="btn" onclick="restartExam()">Take Another Exam</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Exam Data Structure
        const examDatabase = {
            'servsafe': {
                name: 'ServSafe Manager Certification',
                description: 'Food Safety Management',
                passingScore: 75,
                questions: [
                    {
                        question: "What is the minimum internal cooking temperature for ground beef?",
                        options: ["145¬∞F (63¬∞C)", "155¬∞F (68¬∞C)", "165¬∞F (74¬∞C)", "135¬∞F (57¬∞C)"],
                        correct: 1,
                        explanation: "Ground beef must be cooked to a minimum internal temperature of 155¬∞F (68¬∞C) for 15 seconds to ensure harmful bacteria like E. coli are destroyed."
                    },
                    {
                        question: "How long can potentially hazardous food be in the temperature danger zone?",
                        options: ["1 hour", "2 hours", "3 hours", "4 hours"],
                        correct: 3,
                        explanation: "Potentially hazardous food should not be in the temperature danger zone (41¬∞F-135¬∞F) for more than 4 hours total time."
                    },
                    {
                        question: "What is the proper way to cool hot food?",
                        options: [
                            "Leave at room temperature",
                            "Cool from 135¬∞F to 70¬∞F within 2 hours, then to 41¬∞F within 4 more hours",
                            "Place directly in refrigerator",
                            "Cool for 1 hour then refrigerate"
                        ],
                        correct: 1,
                        explanation: "The two-stage cooling method requires cooling food from 135¬∞F to 70¬∞F within 2 hours, then from 70¬∞F to 41¬∞F within an additional 4 hours."
                    },
                    {
                        question: "When should food handlers wash their hands?",
                        options: [
                            "Only before starting work",
                            "After touching raw meat, after using restroom, before handling ready-to-eat food",
                            "Once per shift",
                            "Only when visibly dirty"
                        ],
                        correct: 1,
                        explanation: "Food handlers must wash hands after handling raw meat, using the restroom, touching face/hair, and before handling ready-to-eat foods."
                    },
                    {
                        question: "What is the minimum internal temperature for reheating previously cooked food?",
                        options: ["145¬∞F (63¬∞C)", "155¬∞F (68¬∞C)", "165¬∞F (74¬∞C)", "175¬∞F (79¬∞C)"],
                        correct: 2,
                        explanation: "All previously cooked potentially hazardous food must be reheated to 165¬∞F (74¬∞C) for 15 seconds within 2 hours."
                    },
                    // Add more ServSafe questions here
                    {
                        question: "What is cross-contamination?",
                        options: [
                            "Cooking food at wrong temperature",
                            "Transfer of harmful substances or microorganisms from one food to another",
                            "Expired food",
                            "Food left at room temperature"
                        ],
                        correct: 1,
                        explanation: "Cross-contamination occurs when harmful bacteria or allergens are transferred from one food or surface to another, often from raw to ready-to-eat foods."
                    }
                ]
            },
            'contractors': {
                name: 'North Carolina Contractors License',
                description: 'General Contracting Exam',
                passingScore: 70,
                questions: [
                    {
                        question: "What is the minimum required bond amount for a North Carolina General Contractor license?",
                        options: ["$5,000", "$7,500", "$10,000", "$15,000"],
                        correct: 1,
                        explanation: "North Carolina requires a $7,500 surety bond for General Contractor licensure to protect consumers."
                    },
                    {
                        question: "How often must a North Carolina contractor license be renewed?",
                        options: ["Annually", "Every 2 years", "Every 3 years", "Every 5 years"],
                        correct: 0,
                        explanation: "North Carolina contractor licenses must be renewed annually by the licensee's birth month."
                    },
                    {
                        question: "What is the maximum project value an unlicensed person can perform?",
                        options: ["$10,000", "$20,000", "$30,000", "$50,000"],
                        correct: 2,
                        explanation: "In North Carolina, projects over $30,000 require a licensed contractor. Projects under this amount may be performed by unlicensed individuals."
                    },
                    {
                        question: "Which of the following is required before starting construction?",
                        options: [
                            "Building permit",
                            "Oral agreement with owner",
                            "Cash payment",
                            "Verbal approval from neighbor"
                        ],
                        correct: 0,
                        explanation: "A building permit must be obtained from the local jurisdiction before construction can begin on most projects."
                    },
                    {
                        question: "What is the statute of limitations for construction defect claims in North Carolina?",
                        options: ["1 year", "3 years", "6 years", "10 years"],
                        correct: 2,
                        explanation: "North Carolina has a 6-year statute of repose for construction defect claims from substantial completion."
                    },
                    {
                        question: "Who is responsible for obtaining workers' compensation insurance?",
                        options: [
                            "The property owner",
                            "The general contractor/employer",
                            "The employee",
                            "The local government"
                        ],
                        correct: 1,
                        explanation: "Employers, including general contractors with 3 or more employees, are required to carry workers' compensation insurance in North Carolina."
                    }
                ]
            },
            'cns': {
                name: 'CNS Medications',
                description: 'Central Nervous System Pharmacology',
                passingScore: 75,
                questions: [
                    {
                        question: "Which neurotransmitter is primarily affected by SSRIs?",
                        options: ["Dopamine", "Serotonin", "Norepinephrine", "GABA"],
                        correct: 1,
                        explanation: "Selective Serotonin Reuptake Inhibitors (SSRIs) primarily work by blocking the reuptake of serotonin in the brain, increasing its availability."
                    },
                    {
                        question: "What is the primary mechanism of action for benzodiazepines?",
                        options: [
                            "Block dopamine receptors",
                            "Enhance GABA activity",
                            "Inhibit serotonin reuptake",
                            "Block sodium channels"
                        ],
                        correct: 1,
                        explanation: "Benzodiazepines enhance the effect of GABA, the main inhibitory neurotransmitter in the CNS, producing anxiolytic and sedative effects."
                    },
                    {
                        question: "Which condition is levodopa primarily used to treat?",
                        options: [
                            "Schizophrenia",
                            "Depression",
                            "Parkinson's disease",
                            "Epilepsy"
                        ],
                        correct: 2,
                        explanation: "Levodopa is converted to dopamine in the brain and is the primary treatment for Parkinson's disease, which involves dopamine deficiency."
                    },
                    {
                        question: "What is a common side effect of first-generation antipsychotics?",
                        options: [
                            "Extrapyramidal symptoms (EPS)",
                            "Weight loss",
                            "Insomnia",
                            "Hypotension only"
                        ],
                        correct: 0,
                        explanation: "First-generation (typical) antipsychotics commonly cause extrapyramidal symptoms including tardive dyskinesia, akathisia, and dystonia due to dopamine blockade."
                    },
                    {
                        question: "Which medication is a first-line treatment for absence seizures?",
                        options: ["Phenytoin", "Ethosuximide", "Carbamazepine", "Lamotrigine"],
                        correct: 1,
                        explanation: "Ethosuximide is specifically effective for absence (petit mal) seizures by blocking T-type calcium channels in thalamic neurons."
                    },
                    {
                        question: "What is serotonin syndrome?",
                        options: [
                            "Lack of serotonin",
                            "Excessive serotonin activity causing confusion, agitation, and hyperthermia",
                            "Normal serotonin level",
                            "Serotonin deficiency in blood"
                        ],
                        correct: 1,
                        explanation: "Serotonin syndrome is a potentially life-threatening condition caused by excessive serotonin activity, often from drug interactions, presenting with mental status changes, autonomic instability, and neuromuscular abnormalities."
                    }
                ]
            }
        };

        // Global Variables
        let currentExam = null;
        let selectedExamKey = null;
        let examQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let startTime = null;
        let timerInterval = null;
        let examSettings = {
            questionCount: 20,
            timeLimit: 30,
            mode: 'practice',
            randomize: true,
            showExplanations: true
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadExamCards();
        });

        function loadExamCards() {
            const selector = document.getElementById('examSelector');
            selector.innerHTML = '';

            Object.keys(examDatabase).forEach(key => {
                const exam = examDatabase[key];
                const card = document.createElement('div');
                card.className = 'exam-card';
                card.onclick = () => selectExam(key);
                card.innerHTML = `
                    <h3>${exam.name}</h3>
                    <p>${exam.description}</p>
                    <div class="questions-count">${exam.questions.length} questions available</div>
                `;
                selector.appendChild(card);
            });
        }

        function selectExam(examKey) {
            selectedExamKey = examKey;
            currentExam = examDatabase[examKey];
            
            // Update question count max value
            const questionCountInput = document.getElementById('questionCount');
            questionCountInput.max = currentExam.questions.length;
            questionCountInput.value = Math.min(20, currentExam.questions.length);

            // Highlight selected card
            document.querySelectorAll('.exam-card').forEach(card => {
                card.style.opacity = '0.6';
            });
            event.target.closest('.exam-card').style.opacity = '1';
            
            document.getElementById('startBtn').disabled = false;
        }

        function startExam() {
            if (!selectedExamKey) {
                alert('Please select an exam first!');
                return;
            }

            // Get settings
            examSettings.questionCount = parseInt(document.getElementById('questionCount').value);
            examSettings.timeLimit = parseInt(document.getElementById('timeLimit').value);
            examSettings.mode = document.getElementById('examMode').value;
            examSettings.randomize = document.getElementById('randomize').checked;
            examSettings.showExplanations = document.getElementById('showExplanations').checked;

            // Prepare questions
            examQuestions = [...currentExam.questions];
            if (examSettings.randomize) {
                examQuestions = shuffleArray(examQuestions);
            }
            examQuestions = examQuestions.slice(0, examSettings.questionCount);

            // Initialize exam state
            currentQuestionIndex = 0;
            userAnswers = new Array(examQuestions.length).fill(null);
            startTime = Date.now();

            // Update UI
            document.querySelector('.home-screen').classList.remove('active');
            document.querySelector('.exam-screen').classList.add('active');
            
            document.getElementById('totalQuestions').textContent = examQuestions.length;
            
            // Start timer if needed
            if (examSettings.timeLimit > 0) {
                startTimer();
            } else {
                document.getElementById('timer').textContent = '‚àû';
            }

            loadQuestion();
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function startTimer() {
            let timeRemaining = examSettings.timeLimit * 60;
            
            timerInterval = setInterval(() => {
                timeRemaining--;
                
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                document.getElementById('timer').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    submitExam();
                }
            }, 1000);
        }

        function loadQuestion() {
            const question = examQuestions[currentQuestionIndex];
            
            // Update progress
            const progress = ((currentQuestionIndex + 1) / examQuestions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            
            // Update question info
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('questionNumber').textContent = 
                `Question ${currentQuestionIndex + 1} of ${examQuestions.length}`;
            document.getElementById('questionText').textContent = question.question;
            
            // Load options
            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                if (userAnswers[currentQuestionIndex] === index) {
                    optionDiv.classList.add('selected');
                }
                
                optionDiv.onclick = () => selectOption(index);
                optionDiv.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                optionsContainer.appendChild(optionDiv);
            });

            // Hide explanation initially
            document.getElementById('explanation').classList.remove('show');
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === examQuestions.length - 1) {
                document.getElementById('nextBtn').style.display = 'none';
                document.getElementById('submitBtn').style.display = 'inline-block';
            } else {
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('submitBtn').style.display = 'none';
            }

            updateScore();
        }

        function selectOption(optionIndex) {
            const question = examQuestions[currentQuestionIndex];
            userAnswers[currentQuestionIndex] = optionIndex;
            
            // Update UI
            document.querySelectorAll('.option').forEach((opt, idx) => {
                opt.classList.remove('selected', 'correct', 'incorrect');
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                }
            });

            // Show feedback in practice mode
            if (examSettings.mode === 'practice') {
                showFeedback(optionIndex, question.correct);
            }
            
            updateScore();
        }

        function showFeedback(selectedIndex, correctIndex) {
            const options = document.querySelectorAll('.option');
            
            options.forEach(opt => opt.classList.add('disabled'));
            
            if (selectedIndex === correctIndex) {
                options[selectedIndex].classList.add('correct');
            } else {
                options[selectedIndex].classList.add('incorrect');
                options[correctIndex].classList.add('correct');
            }

            // Show explanation
            if (examSettings.showExplanations) {
                const question = examQuestions[currentQuestionIndex];
                const explanationDiv = document.getElementById('explanation');
                explanationDiv.innerHTML = `
                    <h4>üí° Explanation</h4>
                    <p>${question.explanation}</p>
                `;
                explanationDiv.classList.add('show');
            }
        }

        function updateScore() {
            let correct = 0;
            userAnswers.forEach((answer, index) => {
                if (answer !== null && answer === examQuestions[index].correct) {
                    correct++;
                }
            });
            
            const answeredCount = userAnswers.filter(a => a !== null).length;
            const percentage = answeredCount > 0 ? Math.round((correct / answeredCount) * 100) : 0;
            document.getElementById('currentScore').textContent = percentage;
        }

        function nextQuestion() {
            if (currentQuestionIndex < examQuestions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        function submitExam() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }

            // Check if all questions answered
            const unanswered = userAnswers.filter(a => a === null).length;
            if (unanswered > 0) {
                if (!confirm(`You have ${unanswered} unanswered question(s). Submit anyway?`)) {
                    return;
                }
            }

            showResults();
        }

        function showResults() {
            const endTime = Date.now();
            const timeTaken = Math.floor((endTime - startTime) / 1000);
            
            let correctCount = 0;
            examQuestions.forEach((question, index) => {
                if (userAnswers[index] === question.correct) {
                    correctCount++;
                }
            });

            const incorrectCount = examQuestions.length - correctCount;
            const percentage = Math.round((correctCount / examQuestions.length) * 100);
            const passed = percentage >= currentExam.passingScore;

            // Update results screen
            document.getElementById('finalScore').textContent = percentage + '%';
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('incorrectCount').textContent = incorrectCount;
            document.getElementById('accuracy').textContent = percentage + '%';
            
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;
            document.getElementById('timeTaken').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;

            const passFail = document.getElementById('passFail');
            if (passed) {
                passFail.textContent = 'üéâ Congratulations! You Passed!';
                passFail.className = 'pass-fail pass';
            } else {
                passFail.textContent = 'üìö Keep Studying! You Can Do Better!';
                passFail.className = 'pass-fail fail';
            }

            // Generate review section
            generateReview();

            // Switch screens
            document.querySelector('.exam-screen').classList.remove('active');
            document.querySelector('.results-screen').classList.add('active');
        }

        function generateReview() {
            const reviewSection = document.getElementById('reviewSection');
            reviewSection.innerHTML = '<h3>üìù Answer Review</h3>';

            examQuestions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer === question.correct;
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${isCorrect ? 'correct' : ''}`;
                
                reviewDiv.innerHTML = `
                    <div class="review-question-header">
                        <strong>Question ${index + 1}</strong>
                        <span>${isCorrect ? '‚úÖ Correct' : '‚ùå Incorrect'}</span>
                    </div>
                    <div class="review-question-text">${question.question}</div>
                    <div class="review-answer">
                        <strong>Your Answer:</strong> ${userAnswer !== null ? question.options[userAnswer] : 'Not answered'}<br>
                        ${!isCorrect ? `<strong>Correct Answer:</strong> ${question.options[question.correct]}<br>` : ''}
                        ${examSettings.showExplanations ? `<strong>Explanation:</strong> ${question.explanation}` : ''}
                    </div>
                `;
                
                reviewSection.appendChild(reviewDiv);
            });
        }

        function reviewAnswers() {
            document.getElementById('reviewSection').scrollIntoView({ behavior: 'smooth' });
        }

        function restartExam() {
            // Reset everything
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            currentExam = null;
            selectedExamKey = null;
            examQuestions = [];
            currentQuestionIndex = 0;
            userAnswers = [];
            startTime = null;
            
            // Reset UI
            document.querySelector('.results-screen').classList.remove('active');
            document.querySelector('.home-screen').classList.add('active');
            
            document.querySelectorAll('.exam-card').forEach(card => {
                card.style.opacity = '1';
            });
            
            document.getElementById('startBtn').disabled = true;
        }
    </script>
</body>
</html>